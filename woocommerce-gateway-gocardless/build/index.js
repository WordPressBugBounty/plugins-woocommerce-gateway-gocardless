(()=>{"use strict";var e={20:(e,t,o)=>{var s=o(609),r=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,o){var s,l={},c=null,d=null;for(s in void 0!==o&&(c=""+o),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)n.call(t,s)&&!a.hasOwnProperty(s)&&(l[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===l[s]&&(l[s]=t[s]);return{$$typeof:r,type:e,key:c,ref:d,props:l,_owner:i.current}}},848:(e,t,o)=>{e.exports=o(20)},609:e=>{e.exports=window.React}},t={};const o=window.wp.htmlEntities,s=window.wp.i18n,r=window.wc.wcBlocksRegistry,n=window.wp.element,i=window.wc.wcSettings,a=()=>{const e=(0,i.getSetting)("gocardless_data",null);if(!e)throw new Error((0,s.__)("GoCardless initialization data is not available","woocommerce-gateway-gocardless"));return e};var l,c,d,u=function o(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}(848);const{description:p,logo_url:w,title:g,isTest:m,billingRequestNonce:_}=a(),f=e=>{const{eventRegistration:t,emitResponse:r,shouldSavePayment:i}=e,{onCheckoutSuccess:l}=t;return(0,n.useEffect)((()=>l((e=>{let t;return new Promise(((o,n)=>{const l={type:"error",messageContext:r.noticeContexts.PAYMENTS},{GoCardlessDropin:c}=window;if(!c)return void o({...l,message:(0,s.__)("GoCardless Drop-in is not available","woocommerce-gateway-gocardless")});const d=e?.processingResponse?.paymentDetails?.billing_request_flow_id,u=e?.processingResponse?.paymentDetails?.billing_request_nonce||_;if(!d)return void o({...l,message:(0,s.__)("Invalid billing request flow ID","woocommerce-gateway-gocardless")});const p={billingRequestFlowID:d,environment:m?"sandbox":"live",onSuccess:(t,r)=>{w(),t&&["fulfilling","fulfilled"].includes(t.status)?(e=>{const{wcAjaxUrl:t}=a(),o=new FormData;for(const t in e)o.append(t,e[t]);const s=t.replace("%%endpoint%%","gocardless_complete_billing_request_flow");return fetch(s,{method:"POST",body:o}).then((e=>e.json()))})({security:u,order_id:e.orderId,billing_request_id:t.id,save_customer_token:i?"yes":"no"}).then((e=>{e&&e.success?o({type:"success",redirectUrl:e.data.redirect_url}):o({...l,message:e.data?.message})})).catch((e=>{o({...l,message:e.message})})):o({...l,message:(0,s.__)("Billing request is not fulfulling or fulfilled yet, please try again later.","woocommerce-gateway-gocardless")})},onExit:(t,o)=>{t&&console.error(t),window.location.href=e.redirectUrl}};t=c.create(p),t.open();const w=()=>{t?.exit()}}))}))),[l,i,r.noticeContexts.PAYMENTS]),(0,o.decodeEntities)(p||"")},y=()=>(0,u.jsx)("img",{src:w,alt:(0,o.decodeEntities)(g),style:{marginRight:"12px",marginBottom:"4px"}}),v=e=>{const{PaymentMethodLabel:t}=e.components;return(0,u.jsx)(t,{text:(0,o.decodeEntities)(g),icon:(0,u.jsx)(y,{})})};(0,r.registerPaymentMethod)({name:"gocardless",label:(0,u.jsx)(v,{}),ariaLabel:(0,s.__)("GoCardless payment method","woocommerce-gateway-gocardless"),canMakePayment:({billingData:e,cartTotals:t})=>{const o=t?.currency_code,s=a()?.supportedCountries||[],r=a()?.supportedCurrencies||[];return s.includes(e?.country)&&r.includes(o)},content:(0,u.jsx)(f,{}),edit:(0,u.jsx)(f,{}),supports:{showSavedCards:null!==(l=a().showSavedCards)&&void 0!==l&&l,showSaveOption:null!==(c=a().showSaveOption)&&void 0!==c&&c,features:null!==(d=a()?.supports)&&void 0!==d?d:[]}})})();