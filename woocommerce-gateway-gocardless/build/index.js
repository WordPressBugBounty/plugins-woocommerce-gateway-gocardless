(()=>{"use strict";var e={251:(e,t,o)=>{var s=o(196),r=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),i=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,o){var s,l={},c=null,d=null;for(s in void 0!==o&&(c=""+o),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)n.call(t,s)&&!a.hasOwnProperty(s)&&(l[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===l[s]&&(l[s]=t[s]);return{$$typeof:r,type:e,key:c,ref:d,props:l,_owner:i.current}}},893:(e,t,o)=>{e.exports=o(251)},196:e=>{e.exports=window.React}},t={};function o(s){var r=t[s];if(void 0!==r)return r.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}(()=>{const e=window.wp.htmlEntities,t=window.wp.i18n,s=window.wc.wcBlocksRegistry,r=window.wp.element,n=window.wc.wcSettings,i=()=>{const e=(0,n.getSetting)("gocardless_data",null);if(!e)throw new Error((0,t.__)("GoCardless initialization data is not available","woocommerce-gateway-gocardless"));return e};var a,l,c,d=o(893);const{description:u,logo_url:p,title:w,isTest:g,billingRequestNonce:m}=i(),_=o=>{const{eventRegistration:s,emitResponse:n,shouldSavePayment:a}=o,{onCheckoutSuccess:l}=s;return(0,r.useEffect)((()=>l((e=>{let o;return new Promise(((s,r)=>{const l={type:"error",messageContext:n.noticeContexts.PAYMENTS},{GoCardlessDropin:c}=window;if(!c)return void s({...l,message:(0,t.__)("GoCardless Drop-in is not available","woocommerce-gateway-gocardless")});const d=e?.processingResponse?.paymentDetails?.billing_request_flow_id,u=e?.processingResponse?.paymentDetails?.billing_request_nonce||m;if(!d)return void s({...l,message:(0,t.__)("Invalid billing request flow ID","woocommerce-gateway-gocardless")});const p={billingRequestFlowID:d,environment:g?"sandbox":"live",onSuccess:(o,r)=>{w(),o&&["fulfilling","fulfilled"].includes(o.status)?(e=>{const{wcAjaxUrl:t}=i(),o=new FormData;for(const t in e)o.append(t,e[t]);const s=t.replace("%%endpoint%%","gocardless_complete_billing_request_flow");return fetch(s,{method:"POST",body:o}).then((e=>e.json()))})({security:u,order_id:e.orderId,billing_request_id:o.id,save_customer_token:a?"yes":"no"}).then((e=>{e&&e.success?s({type:"success",redirectUrl:e.data.redirect_url}):s({...l,message:e.data?.message})})).catch((e=>{s({...l,message:e.message})})):s({...l,message:(0,t.__)("Billing request is not fulfulling or fulfilled yet, please try again later.","woocommerce-gateway-gocardless")})},onExit:(t,o)=>{t&&console.error(t),window.location.href=e.redirectUrl}};o=c.create(p),o.open();const w=()=>{o?.exit()}}))}))),[l,a,n.noticeContexts.PAYMENTS]),(0,e.decodeEntities)(u||"")},f=()=>(0,d.jsx)("img",{src:p,alt:(0,e.decodeEntities)(w),style:{marginRight:"12px",marginBottom:"4px"}}),y=t=>{const{PaymentMethodLabel:o}=t.components;return(0,d.jsx)(o,{text:(0,e.decodeEntities)(w),icon:(0,d.jsx)(f,{})})};(0,s.registerPaymentMethod)({name:"gocardless",label:(0,d.jsx)(y,{}),ariaLabel:(0,t.__)("GoCardless payment method","woocommerce-gateway-gocardless"),canMakePayment:({billingData:e,cartTotals:t})=>{const o=t?.currency_code,s=i()?.supportedCountries||[],r=i()?.supportedCurrencies||[];return s.includes(e?.country)&&r.includes(o)},content:(0,d.jsx)(_,{}),edit:(0,d.jsx)(_,{}),supports:{showSavedCards:null!==(a=i().showSavedCards)&&void 0!==a&&a,showSaveOption:null!==(l=i().showSaveOption)&&void 0!==l&&l,features:null!==(c=i()?.supports)&&void 0!==c?c:[]}})})()})();